<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>WishSnap é¡˜æœ›è„†éŸ¿ | è©¦ç©ç‰ˆ</title>
    <!-- å¼•å…¥ SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- å¼•å…¥ Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <!-- å¼•å…¥å½©å¸¶å‹•ç•«åº« -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        /* ==================== 
           CSS æ¨£å¼å€åŸŸ 
           ==================== */
        
        :root {
            --primary-color: #ff5a78; /* å“ç‰Œä¸»è‰² */
            --bg-gradient: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
        }

        body {
            margin: 0;
            padding: 0;
            background-image: url('png/bg.png'); /* é ç•™æ‚¨çš„èƒŒæ™¯åœ–è·¯å¾‘ */
            background-color: #fcebd9; /* å‚™ç”¨èƒŒæ™¯è‰² */
            background-size: cover;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: "Helvetica Neue", Arial, sans-serif;
            overflow-x: hidden;
            user-select: none; /* é˜²æ­¢é¸å–æ–‡å­—å½±éŸ¿é«”é©— */
        }

        /* å“ç‰Œ Logo å€ */
        .brand-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: #d35400;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0px #fff;
            font-family: 'Comic Sans MS', cursive;
        }
        
        .brand-slogan {
            font-size: 1rem;
            color: #888;
            margin-bottom: 30px;
            letter-spacing: 2px;
        }

        .game-container {
            text-align: center;
            position: relative;
            padding: 20px;
        }

        /* é¤…ä¹¾æ©Ÿæ¨£å¼ - å¢åŠ äº’å‹•æ¸¸æ¨™ */
        .cookie-machine {
            max-width: 300px;
            width: 80vw;
            margin-bottom: 20px;
            cursor: grab; /* æç¤ºå¯ä»¥æŠ“å– */
            transition: transform 0.1s;
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.2));
        }

        .cookie-machine:active {
            cursor: grabbing; /* æŠ“å–æ™‚çš„æ¸¸æ¨™ */
            transform: scale(0.98);
        }

        /* æç¤ºæ–‡å­— */
        .shake-hint {
            background: rgba(255, 255, 255, 0.8);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #555;
            margin-top: 15px;
            display: inline-block;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        /* æŒ‰éˆ•æ¨£å¼å„ªåŒ– */
        .fortune-btn {
            background: linear-gradient(45deg, #FF512F 0%, #DD2476 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(221, 36, 118, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }

        .fortune-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(221, 36, 118, 0.6);
        }

        .fortune-btn:active {
            transform: translateY(1px);
        }

        /* åŠ‡çƒˆæ–æ™ƒå‹•ç•« (CSS Animation) */
        @keyframes intenseShake {
            0% { transform: translate(0, 0) rotate(0deg); }
            10% { transform: translate(-10px, -10px) rotate(-10deg); }
            20% { transform: translate(10px, 10px) rotate(10deg); }
            30% { transform: translate(-10px, 10px) rotate(-10deg); }
            40% { transform: translate(10px, -10px) rotate(10deg); }
            50% { transform: translate(-5px, 5px) rotate(-5deg); }
            60% { transform: translate(5px, -5px) rotate(5deg); }
            70% { transform: translate(-5px, -5px) rotate(-5deg); }
            80% { transform: translate(5px, 5px) rotate(5deg); }
            90% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }

        .shake-animation {
            animation: intenseShake 0.5s ease-in-out infinite;
        }

        /* å•†æ¥­åŒ–å½ˆçª—æ¨£å¼ */
        .promo-card {
            background: #fff5f5;
            border: 2px dashed #ffb3b3;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            text-align: left;
        }
        
        .promo-title {
            font-size: 0.9em;
            color: #d63031;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .promo-product {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .promo-img {
            width: 60px;
            height: 60px;
            background: #ddd;
            border-radius: 8px;
            object-fit: cover;
        }

        .promo-info h4 {
            margin: 0;
            font-size: 1em;
            color: #333;
        }

        .coupon-code {
            display: inline-block;
            background: #ffeaa7;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-weight: bold;
            margin-top: 5px;
            border: 1px solid #fdcb6e;
        }

        .buy-btn {
            display: block;
            width: 100%;
            padding: 8px;
            background: #00b894;
            color: white;
            text-align: center;
            text-decoration: none;
            border-radius: 5px;
            margin-top: 10px;
            font-weight: bold;
            transition: background 0.3s;
        }

        .buy-btn:hover {
            background: #00a884;
        }

        /* è¿”å›æŒ‰éˆ• (ä¿ç•™åŸæœ¬çš„) */
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.8);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

    </style>
</head>
<body>

    <!-- éŸ³æ•ˆå…ƒç´  (è«‹æº–å‚™ sounds/shake.mp3 å’Œ sounds/success.mp3) -->
    <audio id="shake-sound" src="sounds/shake.mp3" preload="auto"></audio>
    <audio id="success-sound" src="sounds/success.mp3" preload="auto"></audio>

    <!-- è¿”å›æŒ‰éˆ• -->
    <button class="back-btn" onclick="alert('è¿”å› Tasksnap é¦–é ')">
        <svg viewBox="0 0 24 24" width="20" height="20">
            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
        </svg>
    </button>

    <!-- å“ç‰Œæ¨™é¡Œ -->
    <div class="animate__animated animate__fadeInDown">
        <div class="brand-title">WishSnap</div>
        <div class="brand-slogan">Make a wish, make it snap.</div>
    </div>

    <div class="game-container animate__animated animate__zoomIn">
        <!-- é¤…ä¹¾æ©Ÿåœ–ç‰‡ (ä½¿ç”¨é è¨­åœ–æˆ–æ˜¯ placeholder) -->
        <!-- æ³¨æ„ï¼šé€™è£¡ä½¿ç”¨äº† placeholder åœ–ç‰‡ï¼Œè«‹æ›¿æ›å›æ‚¨çš„ png/cookie_machine.png -->
        <img src="cookie_machine.png" 
             onerror="this.src='https://placehold.co/400x400/ffeaa7/d35400?text=Cookie+Machine&font=roboto'" 
             alt="WishSnap Machine" 
             class="cookie-machine"
             id="machine">
        
        <br>
        
        <!-- æç¤ºæ–‡å­— -->
        <div class="shake-hint">
            ğŸ‘‹ æ‰‹æ©Ÿæ–ä¸€æ– / ğŸ­ é›»è…¦å¿«é€Ÿæ™ƒå‹•æ»‘é¼ 
        </div>

        <br>

        <button class="fortune-btn" onclick="getFortune()">
            <span class="front">æ‰‹å‹•æŠ½ç±¤</span>
        </button>
    </div>

    <script>
        /* ==================== 
           JavaScript é‚è¼¯å€åŸŸ 
           ==================== */

        // 1. æ¨¡æ“¬è³‡æ–™åº« (åŒ…å«å•†æ¥­åŒ–å…§å®¹)
        const fortuneDatabase = [
            {
                type: 'å¤§å‰',
                text: 'ä»Šæ—¥é©åˆå¤§è†½å˜—è©¦ï¼Œä½ çš„å‰µæ„å°‡æœƒè®Šç¾ï¼',
                product: 'ç‰¹æ¿ƒé»‘å·§å…‹åŠ›å¹¸é‹é¤…ä¹¾',
                desc: 'è‹¦ç”œäº¤ç¹”çš„å¤§äººå‘³ï¼ŒåŠ©ä½ æ€ç·’æ¸…æ™°ã€‚',
                coupon: 'LUCKY888',
                color: '#d63031'
            },
            {
                type: 'ä¸­å‰',
                text: 'ä¿æŒè€å¿ƒï¼Œå¥½äº‹å¤šç£¨ï¼Œæ­£å¦‚çƒ˜ç„™éœ€è¦æ™‚é–“ã€‚',
                product: 'ç¶“å…¸åŸå‘³é¦™è‰è„†é¤…',
                desc: 'å›æ­¸åˆå¿ƒï¼Œæœ€ç´”ç²¹çš„ç¾å‘³ã€‚',
                coupon: 'SIMPLE20',
                color: '#e17055'
            },
            {
                type: 'å°ç¢ºå¹¸',
                text: 'ä¸ç®¡ä»Šå¤©å¤šç´¯ï¼Œåƒä¸€å£ç”œçš„å°±æ²’äº‹äº†ã€‚',
                product: 'è‰è“ç…‰ä¹³å¤¾å¿ƒé¤…',
                desc: 'ç™‚ç™’ç³»é¦–é¸ï¼Œå¿ƒæƒ…ç¬é–“ç²‰ç´…ã€‚',
                coupon: 'SWEET520',
                color: '#fd79a8'
            },
            {
                type: 'æ©Ÿæœƒ',
                text: 'ä½ æ­£åœ¨å°‹æ‰¾çš„ç­”æ¡ˆï¼Œå°±åœ¨ä¸‹ä¸€å¡Šé¤…ä¹¾è£¡ã€‚',
                product: 'å®‡æ²»æŠ¹èŒ¶ç´…è±†é¤…ä¹¾',
                desc: 'æ·±é‚ƒçš„èŒ¶é¦™ï¼Œå¸¶çµ¦ä½ å¹³éœèˆ‡æ™ºæ…§ã€‚',
                coupon: 'ZEN2025',
                color: '#00b894'
            }
        ];

        let isShaking = false;
        let shakeDebounce = false;

        // 2. æ ¸å¿ƒæŠ½ç±¤å‡½å¼
        function getFortune() {
            if (shakeDebounce) return;
            shakeDebounce = true;

            const machine = document.getElementById('machine');
            
            // æ’­æ”¾æ–æ™ƒéŸ³æ•ˆ
            document.getElementById('shake-sound').play().catch(e => console.error("éŸ³æ•ˆæ’­æ”¾å¤±æ•—:", e));

            // è¦–è¦ºå›é¥‹ï¼šåŠ‡çƒˆæ–æ™ƒå‹•ç•«
            machine.classList.add('shake-animation');
            document.querySelector('.shake-hint').innerText = "âœ¨ æ­£åœ¨èˆ‡å®‡å®™é€£ç·š... âœ¨";
            document.querySelector('.shake-hint').style.color = "#d35400";
            document.querySelector('.shake-hint').style.fontWeight = "bold";

            // ç¸®çŸ­ç­‰å¾…æ™‚é–“è‡³ 2 ç§’ (å„ªåŒ–é«”é©—)
            setTimeout(() => {
                showResult();
                machine.classList.remove('shake-animation');
                document.querySelector('.shake-hint').innerText = "ğŸ‘‹ æ‰‹æ©Ÿæ–ä¸€æ– / ğŸ­ é›»è…¦å¿«é€Ÿæ™ƒå‹•æ»‘é¼ ";
                document.querySelector('.shake-hint').style.color = "#555";
                document.querySelector('.shake-hint').style.fontWeight = "normal";
                shakeDebounce = false;
            }, 2000);
        }

        // 3. é¡¯ç¤ºçµæœ (åŒ…å«å•†æ¥­åŒ–å°è³¼ UI)
        function showResult() {
            // æ’­æ”¾æˆåŠŸéŸ³æ•ˆ
            document.getElementById('success-sound').play().catch(e => console.error("éŸ³æ•ˆæ’­æ”¾å¤±æ•—:", e));

            // è§¸ç™¼å½©å¸¶å‹•ç•«
            confetti({
                particleCount: 150,
                spread: 100,
                origin: { y: 0.6 }
            });

            // éš¨æ©Ÿé¸ä¸€å€‹
            const result = fortuneDatabase[Math.floor(Math.random() * fortuneDatabase.length)];
            
            // ä½¿ç”¨ SweetAlert2 é¡¯ç¤º Rich Content
            Swal.fire({
                title: `<span style="color:${result.color}">${result.type}</span>`,
                html: `
                    <div style="font-size: 1.2em; font-weight: bold; margin-bottom: 15px;">
                        ${result.text}
                    </div>
                    
                    <!-- å•†æ¥­åŒ–å°è³¼å€å¡Š -->
                    <div class="promo-card">
                        <div class="promo-title">ğŸ‘‡ ä»Šæ—¥é–‹é‹è™•æ–¹ ğŸ‘‡</div>
                        <div class="promo-product">
                            <img src="https://placehold.co/100x100/ffeaa7/d35400?text=Cookie" class="promo-img">
                            <div class="promo-info">
                                <h4>${result.product}</h4>
                                <div style="font-size: 0.8em; color: #666;">${result.desc}</div>
                                <div class="coupon-code">æŠ˜æ‰£ç¢¼: ${result.coupon}</div>
                            </div>
                        </div>
                        <a href="#" class="buy-btn" onclick="Swal.close()">ç«‹å³è³¼è²·é–‹é‹é¤…ä¹¾</a>
                    </div>
                `,
                icon: 'success', // æˆ–ä½¿ç”¨ customClass.icon è‡ªå®šç¾©åœ–ç‰‡
                confirmButtonText: 'æ”¶ä¸‹å¥½é‹',
                confirmButtonColor: '#ff5a78',
                background: '#fff',
                showClass: {
                    popup: 'animate__animated animate__bounceIn'
                }
            });
        }

        // 4. PC æ»‘é¼ æ–æ™ƒåµæ¸¬é‚è¼¯
        function initMouseShake() {
            let lastX = 0;
            let lastY = 0;
            let totalDistance = 0;
            let timeout;
            const SHAKE_THRESHOLD = 500; // è§¸ç™¼é–€æª» (åƒç´ )

            document.addEventListener('mousemove', (e) => {
                if (shakeDebounce) return; // å¦‚æœæ­£åœ¨æŠ½ç±¤ä¸­ï¼Œä¸åµæ¸¬

                if (lastX === 0 && lastY === 0) {
                    lastX = e.clientX;
                    lastY = e.clientY;
                    return;
                }

                const deltaX = Math.abs(e.clientX - lastX);
                const deltaY = Math.abs(e.clientY - lastY);
                
                // åªæœ‰å¿«é€Ÿç§»å‹•æ‰ç®—
                if (deltaX + deltaY > 10) { 
                    totalDistance += (deltaX + deltaY);
                }

                lastX = e.clientX;
                lastY = e.clientY;

                // æª¢æŸ¥æ˜¯å¦é”åˆ°æ–æ™ƒé–€æª»
                if (totalDistance > SHAKE_THRESHOLD) {
                    console.log("Mouse Shake Detected!");
                    getFortune();
                    totalDistance = 0;
                }

                // å¦‚æœåœä¸‹ä¾†è¶…é 0.2 ç§’ï¼Œè·é›¢æ­¸é›¶
                clearTimeout(timeout);
                timeout = setTimeout(() => {
                    totalDistance = 0;
                }, 200);
            });
        }

        // 5. æ‰‹æ©Ÿé™€èºå„€æ–æ™ƒåµæ¸¬
        function initDeviceShake() {
            let lastX, lastY, lastZ;
            let moveCounter = 0;

            if (window.DeviceMotionEvent) {
                window.addEventListener('devicemotion', function(event) {
                    if(shakeDebounce) return;

                    let acc = event.accelerationIncludingGravity;
                    if(!acc.x) return;

                    if(!lastX) {
                        lastX = acc.x; lastY = acc.y; lastZ = acc.z;
                        return;
                    }

                    let deltaX = Math.abs(acc.x - lastX);
                    let deltaY = Math.abs(acc.y - lastY);
                    let deltaZ = Math.abs(acc.z - lastZ);

                    if(deltaX + deltaY + deltaZ > 25) { // æ–æ™ƒé–¾å€¼
                        moveCounter++;
                        if(moveCounter > 5) {
                            getFortune();
                            moveCounter = 0;
                        }
                    } else {
                        moveCounter = Math.max(0, moveCounter - 1);
                    }

                    lastX = acc.x; lastY = acc.y; lastZ = acc.z;
                }, false);
            }
        }

        // åˆå§‹åŒ–
        window.onload = () => {
            initMouseShake();
            initDeviceShake();
        };

    </script>
</body>
</html>